<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
                   http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet author="echerkas (generated)" id="1516384652249-1">
        <createTable tableName="blocking_features">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="blocking_name" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-2">
        <createTable tableName="contract">
            <column autoIncrement="true" name="contract_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="t_number" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="customer_customer_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="tarif_tarif_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-3">
        <createTable tableName="customer">
            <column autoIncrement="true" name="customer_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="surname" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="birth_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="passport_data" type="VARCHAR(45)"/>
            <column name="address" type="VARCHAR(45)"/>
            <column name="tel_number" type="VARCHAR(45)"/>
            <column name="mail" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="sso_id" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-4">
        <createTable tableName="customer_has_user_profile">
            <column name="user_profile_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-5">
        <createTable tableName="feature">
            <column autoIncrement="true" name="feature_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="connection_cost" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-6">
        <createTable tableName="feature_x_blocking_features">
            <column name="feature_feature_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="blocking_feature_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-7">
        <createTable tableName="persistent_logins">
            <column name="series" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="token" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
            <column name="last_used" type="TIMESTAMP(19)"/>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-8">
        <createTable tableName="tarif">
            <column autoIncrement="true" name="tarif_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-9">
        <createTable tableName="tarif_x_feature">
            <column name="tarif_tarif_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="feature_feature_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-10">
        <createTable tableName="user_profile">
            <column autoIncrement="true" name="profile_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="type" type="VARCHAR(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-11">
        <addPrimaryKey columnNames="user_profile_id, user_id" constraintName="PRIMARY" tableName="customer_has_user_profile"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-12">
        <addPrimaryKey columnNames="feature_feature_id, blocking_feature_id" constraintName="PRIMARY" tableName="feature_x_blocking_features"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-13">
        <addPrimaryKey columnNames="series" constraintName="PRIMARY" tableName="persistent_logins"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-14">
        <addPrimaryKey columnNames="tarif_tarif_id, feature_feature_id" constraintName="PRIMARY" tableName="tarif_x_feature"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-15">
        <addUniqueConstraint columnNames="name" constraintName="name_UNIQUE" tableName="tarif"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-16">
        <addUniqueConstraint columnNames="sso_id" constraintName="sso_id_UNIQUE" tableName="customer"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-17">
        <addUniqueConstraint columnNames="t_number" constraintName="t_number_UNIQUE" tableName="contract"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-18">
        <addUniqueConstraint columnNames="tel_number" constraintName="tel_number_UNIQUE" tableName="customer"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-19">
        <addUniqueConstraint columnNames="token" constraintName="token_UNIQUE" tableName="persistent_logins"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-20">
        <addUniqueConstraint columnNames="type" constraintName="type_UNIQUE" tableName="user_profile"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-21">
        <addUniqueConstraint columnNames="username" constraintName="username_UNIQUE" tableName="persistent_logins"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-22">
        <createIndex indexName="fk_contract_customer1_idx" tableName="contract">
            <column name="customer_customer_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-23">
        <createIndex indexName="fk_contract_tarif1_idx" tableName="contract">
            <column name="tarif_tarif_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-24">
        <createIndex indexName="fk_option_has_blocking_options_blocking_options1_idx" tableName="feature_x_blocking_features">
            <column name="blocking_feature_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-25">
        <createIndex indexName="fk_option_has_blocking_options_option1_idx" tableName="feature_x_blocking_features">
            <column name="feature_feature_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-26">
        <createIndex indexName="fk_tarif_has_option_option1_idx" tableName="tarif_x_feature">
            <column name="feature_feature_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-27">
        <createIndex indexName="fk_tarif_has_option_tarif1_idx" tableName="tarif_x_feature">
            <column name="tarif_tarif_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-28">
        <createIndex indexName="fk_user_profile_has_customer_customer1_idx" tableName="customer_has_user_profile">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-29">
        <createIndex indexName="fk_user_profile_has_customer_user_profile1_idx" tableName="customer_has_user_profile">
            <column name="user_profile_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-30">
        <addForeignKeyConstraint baseColumnNames="customer_customer_id" baseTableName="contract" constraintName="fk_contract_customer1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="customer_id" referencedTableName="customer"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-31">
        <addForeignKeyConstraint baseColumnNames="tarif_tarif_id" baseTableName="contract" constraintName="fk_contract_tarif1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="tarif_id" referencedTableName="tarif"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-32">
        <addForeignKeyConstraint baseColumnNames="blocking_feature_id" baseTableName="feature_x_blocking_features" constraintName="fk_option_has_blocking_options_blocking_options1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="blocking_features"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-33">
        <addForeignKeyConstraint baseColumnNames="feature_feature_id" baseTableName="feature_x_blocking_features" constraintName="fk_option_has_blocking_options_option1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="feature_id" referencedTableName="feature"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-34">
        <addForeignKeyConstraint baseColumnNames="feature_feature_id" baseTableName="tarif_x_feature" constraintName="fk_tarif_has_option_option1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="feature_id" referencedTableName="feature"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-35">
        <addForeignKeyConstraint baseColumnNames="tarif_tarif_id" baseTableName="tarif_x_feature" constraintName="fk_tarif_has_option_tarif1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="tarif_id" referencedTableName="tarif"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-36">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="customer_has_user_profile" constraintName="fk_user_profile_has_customer_customer1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="customer_id" referencedTableName="customer"/>
    </changeSet>
    <changeSet author="echerkas (generated)" id="1516384652249-37">
        <addForeignKeyConstraint baseColumnNames="user_profile_id" baseTableName="customer_has_user_profile" constraintName="fk_user_profile_has_customer_user_profile1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="profile_id" referencedTableName="user_profile"/>
    </changeSet>
    <include file="src/main/resources/createContractHasFeature.xml"/>
</databaseChangeLog>
